<script>
import { GlModal, GlSkeletonLoader } from '@gitlab/ui';
import SolutionCard from 'ee/vue_shared/security_reports/components/solution_card_vuex.vue';
import VulnerabilityDetailsGraphql from 'ee/security_dashboard/components/shared/vulnerability_details_graphql/index.vue';

export default {
  components: {
    GlModal,
    GlSkeletonLoader,
    SolutionCard,
    VulnerabilityDetailsGraphql,
  },
  props: {
    uuid: {
      type: String,
      required: true,
    },
  },
  data() {
    return {
      // this is just a placeholder to capture the logic that has been captured in: https://gitlab.com/groups/gitlab-org/-/epics/8910
      // once we add apollo to query the finding, the loading state will be coming from there
      isLoading: true,
      finding: {},
    };
  },
  computed: {
    remediation() {
      return this.finding.remediations?.[0];
    },
    canDownloadPatchForThisVulnerability() {
      return !this.finding.hasMergeRequest && this.remediation?.diff?.length > 0;
    },
  },
};
</script>

<template>
  <gl-modal :visible="true" modal-id="security-finding-details" @hide="$emit('hide')">
    <template #modal-header>
      <gl-skeleton-loader
        v-if="isLoading"
        data-testid="title-loading-indicator"
        :width="400"
        :lines="1"
      />
      <h2 v-else class="gl-m-0 gl-font-lg">{{ finding.title }}</h2>
    </template>
    <div v-if="isLoading" data-testid="content-loading-indicator">
      <!-- this is ajust a placeholder until the designs have been finalized. Captured in: https://gitlab.com/gitlab-org/gitlab/-/issues/377217 -->
      <!-- the skeleton loaders will also be moved into a separate component so they can be re-used -->
      <gl-skeleton-loader :width="80" :lines="1" />
      <gl-skeleton-loader :width="200" :lines="1" />
    </div>
    <template v-else>
      <vulnerability-details-graphql v-bind="finding" />
      <solution-card
        :solution="finding.solution"
        :remediation="remediation"
        :has-mr="finding.hasMergeRequest"
        :has-download="canDownloadPatchForThisVulnerability"
      />
      <!-- adding the comment-history is captured in: https://gitlab.com/gitlab-org/gitlab/-/issues/337488 -->
      <!-- implementing and adding the footer is captured in: https://gitlab.com/gitlab-org/gitlab/-/issues/337487 -->
    </template>
  </gl-modal>
</template>
